<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nitrogen Mustards</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <style>
         .sidebar-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #1a2980;
            border-radius: 50%;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .sidebar-toggle:hover {
            background-color: rgba(255, 255, 255, 1);
            transform: scale(1.1);
        }
        
        .sidebar-toggle-icon {
            font-size: 20px;
            color: white;
        }
        
        /* WHITE SIDEBAR STYLES */
        .sidebar {
            width: 280px;
            background: white;
            color: #333;
            padding: 30px 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 999;
            left: -280px;
            top: 0;
            transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 2px 0 15px rgba(0, 0, 0, 0.05);
            border-right: 1px solid #eee;
        }
        
        .sidebar.active {
            left: 0;
        }
        
        .sidebar h2 {
            color: #1a2980;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            font-size: 1.5rem;
        }
        
        /* NAVIGATION LINKS */
        .nav-links {
            list-style: none;
            padding: 0;
        }
        
        .nav-links li {
            margin-bottom: 10px;
        }
        
        .nav-links a {
            color: #555;
            text-decoration: none;
            display: block;
            padding: 10px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .nav-links a:hover {
            background: rgba(255,255,255,0.1);
        }

        /* SUBMENU STYLES */
        .sub-links {
            list-style: none;
            padding-left: 15px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .has-submenu.active .sub-links {
            max-height: 500px;
        }

        .sub-links a {
            padding: 8px;
            font-size: 0.9em;
            opacity: 0.8;
        }

        
        .sub-links a:hover {
            background-color: #f8f9fa;
        }

        .sub-links.active {
            display: block;
        }

        .has-submenu {
            position: relative;
        }

        .has-submenu::after {
            content: '▼';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8em;
            transition: transform 0.3s ease;
        }

        .has-submenu.active::after {
            transform: translateY(-50%) rotate(180deg);
        }

        
        /* Reset and base styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
        width: 100%;
        height: 100%;
        font-family: 'Arial', sans-serif;
        color: #333;
        line-height: 1.6;
        scroll-behavior: smooth;
        background: #f5f7fa;
        }

        body {
            overflow-x: hidden;
            overflow-y: auto;
            margin: 0;
        }

        .scene {
            min-height: auto;
            height:auto;
            padding: 80px 40px;
            margin-bottom: 40px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
            max-width: 1000px;
            margin: 60px auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: visible;
        }

        .header {
            text-align: center;
            padding: 80px 20px 60px;
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            color: white;
            position: relative;
            z-index: 10;
            clip-path: polygon(0 0, 100% 0, 100% 90%, 0 100%);
            margin-bottom: -30px;
        }
        
        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.3rem;
            max-width: 800px;
            margin: 0 auto;
            opacity: 0.9;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 250px;
            }
            
            .sidebar-expanded .main-content {
                position: fixed;
                left: 250px;
                width: 100%;
            }
            
            .sidebar-expanded::after {
                content: '';
                position: fixed;
                top: 0;
                left: 250px;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                z-index: 998;
            }
        }

        @media (max-width: 576px) {
            .header {
                padding: 60px 20px 40px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .team-members {
                padding: 20px;
                margin-bottom: 40px;
            }
            
            .scene {
                padding: 40px 20px;
                margin: 30px auto;
            }
            
            .scene h2 {
                font-size: 1.5rem;
            }
            
            .battlefield, .lab, .dna-animation, .treatment-scene {
                height: 280px;
            }
            
            .drug-types {
                gap: 15px;
            }
            
            .drug-card {
                width: 140px;
                height: 140px;
            }
            
            .drug-icon {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            .drug-card h4 {
                font-size: 16px;
                margin: 10px 0 5px;
            }
            
            .chemical-structure {
                height: 120px;
                margin: 30px 0;
            }
            
            .footer {
                padding: 60px 20px;
            }
            
            .footer p {
                font-size: 1.1rem;
            }
        }

    
        .drug-card {
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .drug-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }
        
        .drug-card-link {
            text-decoration: none;
            color: inherit;
        }

        .animation-tooltip {
            position: absolute;
            background: rgba(0,0,0,0.85);
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 13px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
            z-index: 10000;
            white-space: nowrap;
            transform: translate(-50%, -110%);
        }

        .key-points, .activation-pathway {
            background: rgba(245, 245, 245, 0.8);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #1a2980;
        }

        .comparison-table {
            width: 100%;
            margin: 20px 0;
            border-collapse: collapse;
        }

        .comparison-table th, .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .comparison-table th {
            background-color: #1a2980;
            color: white;
        }

        .comparison-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        .molecular-detail {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        @keyframes highlight {
            from { background-color: rgba(100, 200, 255, 0.3); }
            to { background-color: transparent; }
        }

        :target {
            animation: highlight 2s ease;
        }


.scene.chemistry-theme {
            width: 100%;
            padding: 2rem;
            background: 
                url('https://www.transparenttextures.com/patterns/hexellence.png') repeat,
                linear-gradient(135deg, #f0f8ff 0%, #e0f7fa 100%);
            background-blend-mode: overlay;
            box-shadow: inset 0 0 0 1000px rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(4px);
            border-top: 6px solid #4db6ac;
            border-bottom: 6px solid #4db6ac;
            box-sizing: border-box;

            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            align-items: center; /* ✅ Center content vertically */
            justify-content: center;
        }

        .source-caption {
            text-align: center;
            font-size: 0.9rem;
            color: #555;
            margin-bottom: 1.5rem;
        }

        .main-caption {
            text-align: center;
            font-weight: 600;
            font-size: 1.2rem;
            color: #00796b;
            margin-top: 1rem;
        }

        #img2 {
      display: none;
      margin-top: 10px;
    }

    img {
      cursor: pointer;
      max-width: 200px;
    }

    .scene img {
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            display: block;
            margin: 0 auto;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }

        .navigation-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 30px;
    }
    
    .navigation-buttons button {
        padding: 12px 24px;
        border: none;
        border-radius: 50px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .navigation-buttons button:nth-child(1),
    .navigation-buttons button:nth-child(2) {
        background: linear-gradient(135deg, #1a2980, #26d0ce);
        color: white;
    }
    
    .navigation-buttons button:last-child {
        background: linear-gradient(135deg, #ff416c, #ff4b2b);
        color: white;
        position: relative;
        overflow: hidden;
    }
    
    .navigation-buttons button:last-child::after {
        content: '↻';
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 18px;
    }
    
    .navigation-buttons button:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }
    
    .navigation-buttons button:active {
        transform: translateY(1px);
    }
    
    .navigation-buttons button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
        box-shadow: none !important;
    }

    .mechanism-visualization {
            height: 400px;
            position: relative;
            margin: 30px 0;
            background: rgba(255,255,255,0.9);
            border-radius: 10px;
            border: 1px solid #eee;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        
        .mechanism-visualization::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="1" height="1" fill="%23eee"/></svg>');
            opacity: 0.3;
        }
        
        .molecule-label {
            position: absolute;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 14px;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transform: translate(-50%, -50%);
        }
        
        .dna-strand {
            position: absolute;
            width: 300px;
            height: 60px;
            background: linear-gradient(to right, #4CAF50, #8BC34A);
            border-radius: 30px;
            opacity: 0;
            transform: scale(0.8);
        }
        
        .blood-brain-barrier {
            position: absolute;
            width: 100%;
            height: 3px;
            background: #1a2980;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            opacity: 0.7;
        }

    </style>
</head>

<body>
        <!-- Sidebar Toggle Button -->
    <div class="sidebar-toggle" id="sidebarToggle">
        <span class="sidebar-toggle-icon">☰</span>
    </div>

    <div class="sidebar">
        <h2>Navigation</h2>
        <ul class="nav-links">
            <li><a href="historical.html">Warhead and Wonder drugs</a></li>
            <li><a href="mechanism.html">Cellular blueprints</a></li>
            <li class="has-submenu">
                <a href="agents.html">Weapons of the cell war</a>
                <ul class="sub-links">
                  <li><a href="agents.html">Summary</a></li>
                  <li><a href="nitrogen-mustards.html">Nitrogen Mustards</a></li>
                  <li><a href="oxazaphosphorines.html">Oxazaphosphorines</a></li>
                  <li><a href="nitrosoureas.html">Nitrosourea</a></li>
                  <li><a href="mitomycin-c.html">Mitomycin C</a></li>
                </ul>
              </li>
            <li><a href="references.html">References</a></li>
            <li><a href="index.html">Authors</a></li>
        </ul>
    </div>


    <div class="header">
        <h1>From Mustard Gas to Chemotherapy</h1>
        <p>From chemical warfare to cancer cure, the alchemical evolution of chemotherapy drugs</p>
    </div>

    <div class="scene">
        <h2>Mitomycin C</h2>
    </div>

    <div class="scene chemistry-theme">
        <figure>

            <img src="mitomycin1.jpeg" alt="Mitomycin1">
            <!--<figcaption class="main-caption">Nitrogen Mustard Activation Pathway</figcaption>-->
            <figcaption class="source-caption">
                <i>Credit to WHERE IS THE SOURCE!!! </i>
    
            </figcaption>
        </figure>
        <p class="description">
            <ul>
                <li>It is a prodrug that requires enzymes to be activated</li>
    
                <li>Such enzymes could include NADPH - CYP450 reductase</li>

                <li>The quinone group (C=O) would undergo the reduction to form hydroquinone (C-OH)</li>
                
                </ul>
        </p>
    </div>

    <div class="scene chemistry-theme">
        <figure>

            <img src=" https://kwhiteson.bio.uci.edu/files/2016/11/m2.png
            " alt="Mitomycin2">
            <!--<figcaption class="main-caption">Nitrogen Mustard Activation Pathway</figcaption>-->
            <figcaption class="source-caption">
                <i>Credit to Whiteson Lab. (n.d.). [Image of molecule M2]. University of California, Irvine. </i>
    
            </figcaption>
        </figure>
        <p class="description">
            <ul>
                <li>The reduction increased the electron strain in the C1, C2 and N10 position</li>
    
                <li>This protonates the N10 nitrogen position, increasing the electrophilicity at C1</li>

                <li>The N2 position of the guanine (minor groove face) will attack the C1 position through nucleophilic attack</li>

                <li>The second alkylating step involves the activation of the C10 position in the methoxy group, making it electrophilic</li>

                <li>C10 will then undergo nucleophilic attack from another guanine at N2 </li>
                
                </ul>
        </p>
    </div>

    <div class="scene chemistry-theme">
        <figure>

            <img src="https://5.imimg.com/data5/EO/FD/MY-2/mitomycin-c-10-mg-inj-500x500.jpg" alt="Mitomycin-C injection">
            <!--<figcaption class="main-caption">Nitrogen Mustard Activation Pathway</figcaption>-->
            <figcaption class="source-caption">
                <i>Credit to IndiaMART. (n.d.). [Image of Mitomycin C 10 mg injection].</i>
    
            </figcaption>
        </figure>
        <p class="description">
            <ul>
                <li>The mitomycin c drug is effective against pancreatic, bladder and breast cancer</li>
    
                <li>It requires enzymes such as NADPH-cytochrome P450 and DT-diaphorase to be activated</li>

                <li>DT-diaphorase is a common genetic marker as it is overexpressed in tumors in the lungs, breast and pancreas. Effective for targeting 
                </li>
                
                </ul>
        </p>
    </div>

    <!-- Mitomycin C Mechanism -->
<div class="scene" id="mitomycin-c-mechanism">
    <h2>Mitomycin C Animation</h2>
    <div class="mechanism-visualization" style="display: flex; justify-content: center; align-items: center;">
        <svg id="mc-animation" width="500" height="280" viewBox="0 0 500 280"></svg>
    </div>
    <div class="legend">
        <div class="legend-item"><div class="legend-color" style="background: #007bff;"></div><span>5'-3' Backbone (Blue)</span></div>
        <div class="legend-item"><div class="legend-color" style="background: #dc3545;"></div><span>3'-5' Backbone (Red)</span></div>
        <div class="legend-item"><div class="legend-color" style="background: #F08080;"></div><span>Adenine (A)</span></div>
        <div class="legend-item"><div class="legend-color" style="background: #F5D67D;"></div><span>Thymine (T)</span></div>
        <div class="legend-item"><div class="legend-color" style="background: #58D68D;"></div><span>Guanine (G)</span></div>
        <div class="legend-item"><div class="legend-color" style="background: #5DADE2;"></div><span>Cytosine (C)</span></div>
        <div class="legend-item"><div class="legend-color" style="background: #BDC3C7;"></div><span>Hydrogen Bonds</span></div>
    </div>
    <div class="explanation-box">
        <h3 id="mc-step-title">Mitomycin C: Step 1</h3>
        <p class="explanation-text" id="mc-explanation"></p>
    </div>
    <div class="navigation-buttons">
        <button id="mc-prev-btn" onclick="navigateTo('previous', 'mitomycin-c')">Previous</button>
        <button id="mc-next-btn" onclick="navigateTo('next', 'mitomycin-c')">Next</button>
        <button onclick="navigateTo('restart', 'mitomycin-c')">Restart</button>
    </div>
</div>

<script>
const svgNS = "http://www.w3.org/2000/svg";

// Helper: Clear SVG
function clearSVG(id) {
    const svg = document.getElementById(id);
    if (!svg) return;
    while (svg.firstChild) svg.removeChild(svg.firstChild);
}

// Helper: Molecule
function createMolecule(svg, id, x, y, color, label, size = 24) {
    const g = document.createElementNS(svgNS, "g");
    g.setAttribute("id", id);
    const circle = document.createElementNS(svgNS, "circle");
    circle.setAttribute("cx", x); circle.setAttribute("cy", y); circle.setAttribute("r", size);
    circle.setAttribute("fill", color);
    circle.setAttribute("stroke", "#333");
    circle.setAttribute("stroke-width", "2");
    g.appendChild(circle);
    if (label) {
        const text = document.createElementNS(svgNS, "text");
        text.setAttribute("x", x);
        text.setAttribute("y", y + size + 18);
        text.setAttribute("text-anchor", "middle");
        text.setAttribute("font-size", "18");
        text.setAttribute("fill", "#333");
        text.setAttribute("font-weight", "bold");
        text.textContent = label;
        g.appendChild(text);
    }
    svg.appendChild(g);
    return g;
}

// Helper: DNA
function createDetailedDNAStrands(svg, idPrefix, x_center, y_offset, overall_height, numSegments = 10) {
    // This is a simplified version (you may use your full function if you like)
    const group = document.createElementNS(svgNS, 'g');
    group.setAttribute('id', `${idPrefix}-dna-helix`);
    svg.appendChild(group);
    const amplitude = 40, frequency = 0.025, segmentStep = 2;
    const backboneColorBlue = '#007bff', backboneColorRed = '#dc3545';
    const adenineColor = '#F08080', thymineColor = '#F5D67D', guanineColor = '#58D68D', cytosineColor = '#5DADE2', hBondColor = '#BDC3C7';
    const backboneWidth = 5, baseRectWidthPurine = 18, baseRectHeightPurine = 10, baseRectWidthPyrimidine = 14, baseRectHeightPyrimidine = 10;
    const allElements = [];
    const sequence = ['A', 'T', 'G', 'C', 'G', 'T', 'A', 'C', 'G', 'A'];
    const numBasePairs = sequence.length;
    const basePairSpacing = overall_height / (numBasePairs + 1);
    const strandBlue = document.createElementNS(svgNS, 'path');
    const strandRed = document.createElementNS(svgNS, 'path');
    let dBlue = '', dRed = '';
    const startY = y_offset;
    const endY = y_offset + overall_height;
    for (let currentY = startY; currentY <= endY; currentY += segmentStep) {
        const xBlue = x_center - amplitude * Math.cos(frequency * (currentY - startY));
        const xRed  = x_center - amplitude * Math.cos(frequency * (currentY - startY) + Math.PI);
        if (currentY === startY) {
            dBlue += `M${xBlue},${currentY}`;
            dRed += `M${xRed},${currentY}`;
        } else {
            dBlue += ` L${xBlue},${currentY}`;
            dRed += ` L${xRed},${currentY}`;
        }
    }
    strandBlue.setAttribute('d', dBlue);
    strandBlue.setAttribute('stroke', backboneColorBlue);
    strandBlue.setAttribute('stroke-width', backboneWidth);
    strandBlue.setAttribute('fill', 'none');
    group.appendChild(strandBlue);
    allElements.push(strandBlue);
    strandRed.setAttribute('d', dRed);
    strandRed.setAttribute('stroke', backboneColorRed);
    strandRed.setAttribute('stroke-width', backboneWidth);
    strandRed.setAttribute('fill', 'none');
    group.appendChild(strandRed);
    allElements.push(strandRed);
    // Base pairs and guanine positions
    const guanines = [];
    for (let i = 0; i < numBasePairs; i++) {
        const currentY = y_offset + (i + 1) * basePairSpacing;
        const xBlue = x_center - amplitude * Math.cos(frequency * (currentY - startY));
        const xRed  = x_center - amplitude * Math.cos(frequency * (currentY - startY) + Math.PI);
        const baseTypeStrand1 = sequence[i];
        let baseTypeStrand2, color1, color2, width1, height1, width2, height2, label1, label2;
        switch (baseTypeStrand1) {
            case 'A':
                baseTypeStrand2 = 'T'; color1 = adenineColor; color2 = thymineColor;
                width1 = baseRectWidthPurine; height1 = baseRectHeightPurine;
                width2 = baseRectWidthPyrimidine; height2 = baseRectHeightPyrimidine;
                label1 = 'A'; label2 = 'T'; break;
            case 'T':
                baseTypeStrand2 = 'A'; color1 = thymineColor; color2 = adenineColor;
                width1 = baseRectWidthPyrimidine; height1 = baseRectHeightPyrimidine;
                width2 = baseRectWidthPurine; height2 = baseRectHeightPurine;
                label1 = 'T'; label2 = 'A'; break;
            case 'G':
                baseTypeStrand2 = 'C'; color1 = guanineColor; color2 = cytosineColor;
                width1 = baseRectWidthPurine; height1 = baseRectHeightPurine;
                width2 = baseRectWidthPyrimidine; height2 = baseRectHeightPyrimidine;
                label1 = 'G'; label2 = 'C'; break;
            case 'C':
                baseTypeStrand2 = 'G'; color1 = cytosineColor; color2 = guanineColor;
                width1 = baseRectWidthPyrimidine; height1 = baseRectHeightPyrimidine;
                width2 = baseRectWidthPurine; height2 = baseRectHeightPurine;
                label1 = 'C'; label2 = 'G'; break;
        }
        // Base 1
        const base1 = document.createElementNS(svgNS, 'rect');
        base1.setAttribute('x', xBlue - width1/2);
        base1.setAttribute('y', currentY - height1/2);
        base1.setAttribute('width', width1);
        base1.setAttribute('height', height1);
        base1.setAttribute('fill', color1);
        group.appendChild(base1);
        allElements.push(base1);
        // Base 2
        const base2 = document.createElementNS(svgNS, 'rect');
        base2.setAttribute('x', xRed - width2/2);
        base2.setAttribute('y', currentY - height2/2);
        base2.setAttribute('width', width2);
        base2.setAttribute('height', height2);
        base2.setAttribute('fill', color2);
        group.appendChild(base2);
        allElements.push(base2);
        // Label1
        const baseLabel1 = document.createElementNS(svgNS, 'text');
        baseLabel1.setAttribute('x', xBlue); baseLabel1.setAttribute('y', currentY + 3);
        baseLabel1.setAttribute('text-anchor', 'middle'); baseLabel1.setAttribute('font-size', '9px');
        baseLabel1.setAttribute('fill', '#fff'); baseLabel1.textContent = label1;
        group.appendChild(baseLabel1);
        allElements.push(baseLabel1);
        // Label2
        const baseLabel2 = document.createElementNS(svgNS, 'text');
        baseLabel2.setAttribute('x', xRed); baseLabel2.setAttribute('y', currentY + 3);
        baseLabel2.setAttribute('text-anchor', 'middle'); baseLabel2.setAttribute('font-size', '9px');
        baseLabel2.setAttribute('fill', '#fff'); baseLabel2.textContent = label2;
        group.appendChild(baseLabel2);
        allElements.push(baseLabel2);
        // Hydrogen bonds
        const hBond = document.createElementNS(svgNS, 'line');
        hBond.setAttribute('x1', xBlue); hBond.setAttribute('y1', currentY);
        hBond.setAttribute('x2', xRed); hBond.setAttribute('y2', currentY);
        hBond.setAttribute('stroke', hBondColor);
        hBond.setAttribute('stroke-width', '2');
        group.appendChild(hBond);
        allElements.push(hBond);
        // Store guanine info for crosslink/covalent animation
        if (baseTypeStrand1 === 'G') {
            guanines.push({
                element: base1,
                n2: { x: xBlue, y: currentY } // For mitomycin C, N2 alkylation is common
            });
        }
        if (baseTypeStrand2 === 'G') {
            guanines.push({
                element: base2,
                n2: { x: xRed, y: currentY }
            });
        }
    }
    return { group, elements: allElements, getGuaninePositions: () => guanines };
}

// Helper: Covalent bond
function createBond(svg, id, x1, y1, x2, y2, color = "#C0392B", width = 4) {
    const line = document.createElementNS(svgNS, "line");
    line.setAttribute("id", id);
    line.setAttribute("x1", x1);
    line.setAttribute("y1", y1);
    line.setAttribute("x2", x2);
    line.setAttribute("y2", y2);
    line.setAttribute("stroke", color);
    line.setAttribute("stroke-width", width);
    line.setAttribute("stroke-dasharray", "6,3");
    line.setAttribute("opacity", "1");
    svg.appendChild(line);
    return line;
}

// --- Mitomycin C Mechanism Logic ---
const mcSteps = [
    "<b>Step 1: Mitomycin C (Prodrug)</b><br>Mitomycin C contains a quinone, an aziridine ring, and a carbamate. It requires enzymatic reduction to become an active DNA alkylator.",
    "<b>Step 2: Enzymatic Reduction (Activation)</b><br>Cellular enzymes (e.g., DT-diaphorase) reduce the quinone moiety of Mitomycin C. This triggers a cascade of chemical changes.",
    "<b>Step 3: Formation of Reactive Species & First DNA Alkylation</b><br>Reduction leads to the spontaneous loss of the methoxy group (if present in analogue) and opening of the aziridine ring. This activated form alkylates DNA, primarily at the N2 position of guanine in the minor groove.",
    "<b>Step 4: Second Alkylation & Interstrand Cross-link</b><br>After the first alkylation, further activation (e.g., elimination of the carbamate group) exposes a second electrophilic site (C10). This site can then alkylate another guanine, often on the complementary DNA strand, forming an interstrand cross-link.",
    "<b>Step 5: Potent DNA Damage</b><br>The interstrand cross-links formed by Mitomycin C are highly cytotoxic, effectively halting DNA replication and leading to cancer cell death. Its activity is often enhanced in hypoxic tumor environments."
];

const mcAnimations = [
    // Step 1: Mitomycin C prodrug
    function() {
        clearSVG('mc-animation');
        const svg = document.getElementById('mc-animation');
        createMolecule(svg, 'mc-drug', 250, 140, '#6A1B9A', 'Mitomycin C', 30);
    },
    // Step 2: Enzymatic Reduction
    function() {
        clearSVG('mc-animation');
        const svg = document.getElementById('mc-animation');
        createMolecule(svg, 'mc-drug', 250, 140, '#6A1B9A', 'Mitomycin C', 30);
        createMolecule(svg, 'enzyme', 140, 110, '#00ACC1', 'Enzyme', 20);
        createMolecule(svg, 'electron', 170, 80, '#FDD835', 'e-', 7);
        // Optionally, add an arrow from enzyme/electron to MC
    },
    // Step 3: First DNA alkylation
    function() {
        clearSVG('mc-animation');
        const svg = document.getElementById('mc-animation');
        // Activated MC
        createMolecule(svg, 'mc-active', 120, 120, '#8E24AA', 'Activated MC', 22);
        // DNA
        const dna = createDetailedDNAStrands(svg, 'mc-dna-step3', 340, 40, 180, 10);
        const guanines = dna.getGuaninePositions();
        if (guanines.length > 0) {
            // Arrow from MC to N2 of a guanine
            const gtarget = guanines[3];
            const arrow = document.createElementNS(svgNS, 'line');
            arrow.setAttribute('x1', 120); arrow.setAttribute('y1', 120);
            arrow.setAttribute('x2', gtarget.n2.x); arrow.setAttribute('y2', gtarget.n2.y);
            arrow.setAttribute('stroke', '#795548'); arrow.setAttribute('stroke-width', '3');
            arrow.setAttribute('marker-end', 'url(#arrowhead)');
            svg.appendChild(arrow);
            // Highlight guanine
            gtarget.element.setAttribute('fill', '#FFC107');
        }
    },
    // Step 4: Interstrand cross-link
    function() {
        clearSVG('mc-animation');
        const svg = document.getElementById('mc-animation');
        const dna = createDetailedDNAStrands(svg, 'mc-dna-step4', 250, 40, 180, 10);
        const guanines = dna.getGuaninePositions();
        if (guanines.length > 4) {
            const g1 = guanines[2], g2 = guanines[7];
            // MC attached
            createMolecule(svg, 'mc-crosslink', g1.n2.x-10, g1.n2.y, '#8E24AA', '', 10);
            // Crosslink bond (dashed)
            createBond(svg, 'mc-crosslink', g1.n2.x, g1.n2.y, g2.n2.x, g2.n2.y, '#D32F2F', 4);
            g1.element.setAttribute('fill', '#FFC107');
            g2.element.setAttribute('fill', '#FFC107');
        }
    },
   // Step 5: Potent DNA Damage (Interstrand Cross-link, faded DNA, cell death message)
   function() {
    clearSVG('mc-animation');
    const svg = document.getElementById('mc-animation');
    // Draw the DNA
    const dna = createDetailedDNAStrands(svg, 'mc-dna-step5', 250, 40, 180, 10);
    const guanines = dna.getGuaninePositions();

    // Draw the crosslink (locks DNA)
    if (guanines.length > 4) {
        createBond(svg, 'mc-crosslink-final',
            guanines[2].n2.x, guanines[2].n2.y,
            guanines[7].n2.x, guanines[7].n2.y,
            '#D32F2F', 7
        );
        guanines[2].element.setAttribute('fill', '#FFC107');
        guanines[7].element.setAttribute('fill', '#FFC107');
    }

    // Draw a "replication fork" (replicase protein) as a blue oval
    const fork = document.createElementNS(svgNS, "ellipse");
    fork.setAttribute("cx", 250);
    fork.setAttribute("cy", 70);
    fork.setAttribute("rx", 30);
    fork.setAttribute("ry", 14);
    fork.setAttribute("fill", "#1565c0");
    fork.setAttribute("stroke", "#333");
    fork.setAttribute("stroke-width", "2");
    svg.appendChild(fork);
    // Add "DNA Pol" label
    const forkLabel = document.createElementNS(svgNS, "text");
    forkLabel.setAttribute("x", 250);
    forkLabel.setAttribute("y", 75);
    forkLabel.setAttribute("text-anchor", "middle");
    forkLabel.setAttribute("font-size", "13");
    forkLabel.setAttribute("fill", "#fff");
    forkLabel.setAttribute("font-weight", "bold");
    forkLabel.textContent = "DNA Pol";
    svg.appendChild(forkLabel);

    // Crosslink position (between guanines)
    const haltY = (guanines[2].n2.y + guanines[7].n2.y) / 2;

    // Animate the fork moving towards the crosslink and "bouncing"
    gsap.to([fork, forkLabel], {
        duration: 1,
        y: haltY - 60,
        onComplete: () => {
            // Quick "bump" effect
            gsap.to([fork, forkLabel], {
                duration: 0.13, y: `+=12`, yoyo: true, repeat: 1, ease: "power2.inOut",
                onComplete: () => {
                    // Fade the fork (show it's dead)
                    gsap.to([fork, forkLabel], { opacity: 0.4, duration: 0.6 });
                }
            });

            // Stop sign and jagged line
            const stop = document.createElementNS(svgNS, "text");
            stop.setAttribute("x", 250);
            stop.setAttribute("y", haltY - 10);
            stop.setAttribute("text-anchor", "middle");
            stop.setAttribute("font-size", "28");
            stop.setAttribute("fill", "#d32f2f");
            stop.setAttribute("font-weight", "bold");
            stop.textContent = "⛔";
            svg.appendChild(stop);

            // Replication Blocked! text
            const blockTxt = document.createElementNS(svgNS, "text");
            blockTxt.setAttribute("x", 250);
            blockTxt.setAttribute("y", haltY + 32);
            blockTxt.setAttribute("text-anchor", "middle");
            blockTxt.setAttribute("font-size", "16");
            blockTxt.setAttribute("fill", "#d32f2f");
            blockTxt.setAttribute("font-weight", "bold");
            blockTxt.textContent = "Replication Blocked!";
            svg.appendChild(blockTxt);

            // Jagged "break" line to indicate block
            const line = document.createElementNS(svgNS, "polyline");
            line.setAttribute("points", `${250-28},${haltY+4} ${250-16},${haltY+16} ${250},${haltY+8} ${250+16},${haltY+18} ${250+28},${haltY+4}`);
            line.setAttribute("stroke", "#d32f2f");
            line.setAttribute("stroke-width", "3");
            line.setAttribute("fill", "none");
            svg.appendChild(line);

            // Cell death label
            const t = document.createElementNS(svgNS, "text");
            t.setAttribute("x", 400);
            t.setAttribute("y", 240);
            t.setAttribute("text-anchor", "middle");
            t.setAttribute("font-size", "22");
            t.setAttribute("fill", "#C62828");
            t.setAttribute("font-weight", "bold");
            t.textContent = "Cell Death";
            svg.appendChild(t);

            // Hypoxia label
            const hypoxia = document.createElementNS(svgNS, "text");
            hypoxia.setAttribute("x", 90);
            hypoxia.setAttribute("y", 260);
            hypoxia.setAttribute("text-anchor", "middle");
            hypoxia.setAttribute("font-size", "15");
            hypoxia.setAttribute("fill", "#3949ab");
            hypoxia.setAttribute("font-weight", "bold");
            hypoxia.setAttribute("opacity", "0.7");
            hypoxia.textContent = "Low O₂ (Hypoxia)";
            svg.appendChild(hypoxia);
        }
    });
}
];

// Animation navigation logic
let mcStep = 0;
function updateMitomycinC() {
    document.getElementById('mc-step-title').innerHTML = `Mitomycin C: Step ${mcStep + 1}`;
    document.getElementById('mc-explanation').innerHTML = mcSteps[mcStep];
    mcAnimations[mcStep]();

    // Previous button state
    document.getElementById('mc-prev-btn').disabled = mcStep === 0;

    // Next button state, label, and color
    const nextBtn = document.getElementById('mc-next-btn');
    if (mcStep === mcSteps.length - 1) {
        nextBtn.disabled = true;
        nextBtn.innerText = "Last Step";
        nextBtn.style.background = "#cce6ff"; // Light blue or any color you like
        nextBtn.style.color = "#333";         // Optional: change text color for contrast
    } else {
        nextBtn.disabled = false;
        nextBtn.innerText = "Next";
        nextBtn.style.background = ""; // Resets to CSS default
        nextBtn.style.color = "";      // Resets to CSS default
    }
}
function navigateTo(action, agent) {
    if (agent === 'mitomycin-c') {
        if (action === 'next' && mcStep < mcSteps.length - 1) mcStep++;
        else if (action === 'previous' && mcStep > 0) mcStep--;
        else if (action === 'restart') mcStep = 0;
        updateMitomycinC();
    }
}
// Initial load
document.addEventListener('DOMContentLoaded', updateMitomycinC);

</script>

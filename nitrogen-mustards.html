<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nitrogen Mustards Mechanism</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
        width: 100%;
        height: 100%;
        font-family: 'Arial', sans-serif;
        color: #333;
        line-height: 1.6;
        scroll-behavior: smooth;
        background: #f5f7fa;
        }

        body {
            overflow-x: hidden;
            overflow-y: auto;
            margin: 0;
        }

        /* Sidebar Styles */
        .sidebar-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #1a2980;
            border-radius: 50%;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .sidebar-toggle:hover {
            background-color: rgba(255, 255, 255, 1);
            transform: scale(1.1);
        }
        
        .sidebar-toggle-icon {
            font-size: 20px;
            color: white;
        }
        
        /* WHITE SIDEBAR STYLES */
        .sidebar {
            width: 280px;
            background: white;
            color: #333;
            padding: 30px 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 999;
            left: -280px;
            top: 0;
            transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 2px 0 15px rgba(0, 0, 0, 0.05);
            border-right: 1px solid #eee;
        }
        
        .sidebar.active {
            left: 0;
        }
        
        .sidebar h2 {
            color: #1a2980;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            font-size: 1.5rem;
        }
        
        /* Navigation Links */
        .nav-links {
            list-style: none;
            padding: 0;
        }
        
        .nav-links li {
            margin-bottom: 10px;
        }
        
        .nav-links a {
            color: #555;
            text-decoration: none;
            display: block;
            padding: 10px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .nav-links a:hover {
            background: rgba(26, 41, 128, 0.1);
            color: var(--primary-color);
        }

        /* Submenu Styles */
        .sub-links {
            list-style: none;
            padding-left: 15px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .has-submenu.active .sub-links {
            max-height: 500px;
        }

        .sub-links a {
            padding: 8px;
            font-size: 0.9em;
            opacity: 0.8;
        }

        .sub-links a:hover {
            background-color: #f8f9fa;
        }

        .has-submenu {
            position: relative;
        }

        .has-submenu::after {
            content: '▼';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8em;
            transition: transform 0.3s ease;
            color: var(--primary-color);
        }

        .has-submenu.active::after {
            transform: translateY(-50%) rotate(180deg);
        }

        
        /* Main Content Styles */
        .scene {
            min-height: auto;
            height:auto;
            padding: 80px 40px;
            margin-bottom: 40px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
            max-width: 1000px;
            margin: 60px auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: visible;
        }

        .header {
            text-align: center;
            padding: 80px 20px 60px;
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            color: white;
            position: relative;
            z-index: 10;
            clip-path: polygon(0 0, 100% 0, 100% 90%, 0 100%);
            margin-bottom: -30px;
        }
        
        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.3rem;
            max-width: 800px;
            margin: 0 auto;
            opacity: 0.9;
        }

        .scene h2 {
            color: var(--primary-color);
            margin-bottom: 25px;
            font-size: 1.8rem;
            position: relative;
            padding-bottom: 10px;
        }

        .scene h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        .scene p {
            margin-bottom: 15px;
            line-height: 1.7;
        }

        /* Mechanism Visualization Styles */
        .mechanism-visualization {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 30px 0;
            background: rgba(245, 245, 245, 0.5);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #eee;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: rgba(245, 245, 245, 0.8);
            border-radius: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-right: 15px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            margin-right: 8px;
            border: 1px solid rgba(0,0,0,0.1);
        }

        .explanation-box {
            background: rgba(245, 245, 245, 0.8);
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid var(--primary-color);
            transition: all 0.3s ease;
        }

        .explanation-box h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .explanation-text {
            line-height: 1.7;
        }

        .navigation-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 30px;
    }
    
    .navigation-buttons button {
        padding: 12px 24px;
        border: none;
        border-radius: 50px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .navigation-buttons button:nth-child(1),
    .navigation-buttons button:nth-child(2) {
        background: linear-gradient(135deg, #1a2980, #26d0ce);
        color: white;
    }
    
    .navigation-buttons button:last-child {
        background: linear-gradient(135deg, #ff416c, #ff4b2b);
        color: white;
        position: relative;
        overflow: hidden;
    }
    
    .navigation-buttons button:last-child::after {
        content: '↻';
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 18px;
    }
    
    .navigation-buttons button:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }
    
    .navigation-buttons button:active {
        transform: translateY(1px);
    }
    
    .navigation-buttons button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
        box-shadow: none !important;
    }

        /* Scientific Highlight Styles */
        .key-points, .activation-pathway {
            background: rgba(245, 245, 245, 0.8);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid var(--primary-color);
        }

        .key-points h3, .activation-pathway h3 {
            margin-bottom: 15px;
        }

        .key-points ul, .activation-pathway ol {
            padding-left: 20px;
        }

        .key-points li, .activation-pathway li {
            margin-bottom: 10px;
        }

        .comparison-table {
            width: 100%;
            margin: 20px 0;
            border-collapse: collapse;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .comparison-table th, .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .comparison-table th {
            background-color: var(--primary-color);
            color: white;
        }

        .comparison-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        .comparison-table tr:hover {
            background-color: rgba(26, 41, 128, 0.05);
        }

        .molecular-detail {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 1px solid #eee;
        }

        .nitrogen-mustard-highlight {
            background-color: rgba(138, 43, 226, 0.1);
            border-left: 4px solid var(--accent-color);
            padding: 15px;
            border-radius: 0 5px 5px 0;
            margin: 15px 0;
        }

        /* Animation Tooltip */
        .animation-tooltip {
            position: absolute;
            background: rgba(0,0,0,0.85);
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 13px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
            z-index: 10000;
            white-space: nowrap;
            transform: translate(-50%, -110%);
            font-family: 'Roboto', sans-serif;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .sidebar {
                width: 250px;
            }
            
            .header {
                padding: 80px 20px 60px;
            }
            
            .header h1 {
                font-size: 2.2rem;
            }
            
            .header p {
                font-size: 1.1rem;
            }
            
            .scene {
                padding: 40px 25px;
                margin: 40px 20px;
            }
            
            .scene h2 {
                font-size: 1.5rem;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .navigation-buttons button {
                width: 100%;
            }
        }

        @media (max-width: 576px) {
            .header {
                padding: 60px 20px 40px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .scene {
                padding: 30px 20px;
                margin: 30px 15px;
            }
            
            .legend {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .explanation-box {
                padding: 20px 15px;
            }
        }

        /* Animations */
        @keyframes highlight {
            from { background-color: var(--highlight-color); }
            to { background-color: transparent; }
        }

        :target {
            animation: highlight 2s ease;
        }

        /* Chemistry Specific Styles */
        .chemical-structure {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .chemical-formula {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            font-size: 1.2rem;
            color: var(--primary-color);
            margin: 15px 0;
        }

        .molecular-weight {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }


.scene.chemistry-theme {
            width: 100%;
            padding: 2rem;
            background: 
                url('https://www.transparenttextures.com/patterns/hexellence.png') repeat,
                linear-gradient(135deg, #f0f8ff 0%, #e0f7fa 100%);
            background-blend-mode: overlay;
            box-shadow: inset 0 0 0 1000px rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(4px);
            border-top: 6px solid #4db6ac;
            border-bottom: 6px solid #4db6ac;
            box-sizing: border-box;

            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            align-items: center; /* ✅ Center content vertically */
            justify-content: center;
        }

        .source-caption {
            text-align: center;
            font-size: 0.9rem;
            color: #555;
            margin-bottom: 1.5rem;
        }

        .main-caption {
            text-align: center;
            font-weight: 600;
            font-size: 1.2rem;
            color: #00796b;
            margin-top: 1rem;
        }

        #img2 {
      display: none;
      margin-top: 10px;
    }

    img {
      cursor: pointer;
      max-width: 200px;
    }

    .scene img {
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            display: block;
            margin: 0 auto;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }

        .navigation-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 30px;
    }
    
    .navigation-buttons button {
        padding: 12px 24px;
        border: none;
        border-radius: 50px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .navigation-buttons button:nth-child(1),
    .navigation-buttons button:nth-child(2) {
        background: linear-gradient(135deg, #1a2980, #26d0ce);
        color: white;
    }
    
    .navigation-buttons button:last-child {
        background: linear-gradient(135deg, #ff416c, #ff4b2b);
        color: white;
        position: relative;
        overflow: hidden;
    }
    
    .navigation-buttons button:last-child::after {
        content: '↻';
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 18px;
    }
    
    .navigation-buttons button:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }
    
    .navigation-buttons button:active {
        transform: translateY(1px);
    }
    
    .navigation-buttons button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
        box-shadow: none !important;
    }

    .mechanism-visualization {
            height: 400px;
            position: relative;
            margin: 30px 0;
            background: rgba(255,255,255,0.9);
            border-radius: 10px;
            border: 1px solid #eee;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        
        .mechanism-visualization::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="1" height="1" fill="%23eee"/></svg>');
            opacity: 0.3;
        }
        
        .molecule-label {
            position: absolute;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 14px;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transform: translate(-50%, -50%);
        }
        
        .dna-strand {
            position: absolute;
            width: 300px;
            height: 60px;
            background: linear-gradient(to right, #4CAF50, #8BC34A);
            border-radius: 30px;
            opacity: 0;
            transform: scale(0.8);
        }
        
        .blood-brain-barrier {
            position: absolute;
            width: 100%;
            height: 3px;
            background: #1a2980;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            opacity: 0.7;
        }


    </style>
</head>

<body>
    <!-- Sidebar Toggle Button -->
    <div class="sidebar-toggle" id="sidebarToggle">
        <span class="sidebar-toggle-icon">☰</span>
    </div>

    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <h2>Navigation</h2>
        <ul class="nav-links">
            <li><a href="historical.html">Warhead and Wonder drugs</a></li>
            <li><a href="mechanism.html">Clean copies</a></li>
            <li class="has-submenu">
                <a href="agents.html">Alkylating Agents</a>
                <ul class="sub-links">
                  <li><a href="agents.html">Summary</a></li>
                  <li><a href="nitrogen-mustards.html">Nitrogen Mustards</a></li>
                  <li><a href="oxazaphosphorines.html">Oxazaphosphorines</a></li>
                  <li><a href="nitrosoureas.html">Nitrosourea</a></li>
                  <li><a href="mitomycin-c.html">Mitomycin C</a></li>
                </ul>
              </li>
            <li><a href="references.html">References</a></li>
            <li><a href="index.html">Authors</a></li>
        </ul>
    </div>

    <!-- Main Header -->
    <div class="header">
        <h1>Nitrogen Mustards Mechanism of Action</h1>
        <p>Understanding the alkylating process that makes these compounds potent chemotherapeutic agents</p>
    </div>

    
    <div class="scene chemistry-theme">
        <figure>

            <img id="img1" src="nitrogen-mustard1.png" alt="Nitrogen Mustard 1">
            <img id="img2" src="nitrogen-mustard2.png" alt="Nitrogen Mustard 2">
            <figcaption class="main-caption">Nitrogen Mustard Activation Pathway</figcaption>
            <figcaption class="source-caption">
                <i>Credit to Polavarapu, A., Stillabower, J. A., Stubblefield, S. G. W., Taylor, W. M., & Baik, M. H. (2012). The mechanism of guanine alkylation by nitrogen mustards: A computational study. Journal of Organic Chemistry, 77(14), 5914–5921. </i>
    
            </figcaption>
        </figure>
        <p class="description">
            The helicase binds tightly to one DNA strand, and as it translocates forward, it pulls that strand.
            This causes the complementary strand to be physically pushed away as base pairing is disrupted.
            The separation destabilizes the nucleotide base pairs, causing them to preferentially separate.
        </p>
    </div>

    <div class="scene chemistry-theme">
        <figure>

            <img src="https://basicmedicalkey.com/wp-content/uploads/2017/04/image02614.jpeg" alt="Nitrogen Mustard3">
            <!--<figcaption class="main-caption">Nitrogen Mustard Activation Pathway</figcaption>-->
            <figcaption class="source-caption">
                <i>Credit to Kumar, V., Abbas, A. K., & Aster, J. C. (2015). Robbins and Cotran pathologic basis of disease (9th ed.). Elsevier.  </i>
            </figcaption>
        </figure>
        <p class="description">
            <ul>
            <li>Aziridinium ion will form a <strong>strong covalent bond between the two strands of DNA</strong>, or more commonly known as interstrand cross-linkage.</li>

            <li>The linkage <strong>prevents the helicase</strong> from separating the two strands apart.</li>
            
            <li>This <strong>halts the α-Polymerase</strong> from making a complete set of Okazaki fragments.</li>
            
            <li>DNA Replication fails</li>
            </ul>
            
        </p>
    </div>

    <div class="scene chemistry-theme">
        <figure>

            <img src="https://petcancersociety.com/wp-content/uploads/mechlorethamine-2-400.png" alt="Mechlorethamine">
            <figcaption class="main-caption">Mechlorethamine</figcaption>
            <figcaption class="source-caption">
                <i>Credit to Pet Cancer Society. (n.d.). [Image of mechlorethamine chemical structure]. Pet Cancer Society.</i>
            </figcaption>
        </figure>
        <p class="description">
            <ul>
            <li>Drugs that are under the Nitrogen Mustard class include Mechlorethamine</li>

            <li>It targets lymphomas, breast carcinoma and solid tumors</li>
            
            </ul>
            
        </p>
    </div>
    
    <!-- Scientific Content Section -->
    <div class="scene">
        <h2>Nitrogen Mustards: Biochemical Mechanism</h2>
        
        <div class="key-points">
            <h3>Key Features of Nitrogen Mustards</h3>
            <ul>
                <li>Bifunctional alkylating agents with two reactive chloroethyl groups</li>
                <li>Form highly reactive aziridinium intermediates via intramolecular cyclization</li>
                <li>Primarily target the N7 position of guanine in DNA (most nucleophilic site)</li>
                <li>Create interstrand cross-links (8-9Å spacing) that block DNA replication</li>
                <li>Cross-links preferentially form at 5'-GNC-3' sequences (N = any base)</li>
            </ul>
        </div>
        
        <p>Nitrogen mustards are a class of bifunctional alkylating agents that exert their cytotoxic effects through covalent modification of DNA. The mechanism involves several distinct steps:</p>
        
        <div class="activation-pathway">
            <h3>Activation Pathway</h3>
            <ol>
                <li><strong>Intramolecular cyclization:</strong> The nitrogen mustard undergoes spontaneous intramolecular cyclization (SN2 reaction) to form an electrophilic aziridinium ion, with chloride as the leaving group.</li>
                <li><strong>Nucleophilic attack:</strong> The N7 position of guanine (pKa ~3.5), being highly nucleophilic due to its lone pair of electrons in the major groove, attacks the aziridinium ion (rate-limiting step).</li>
                <li><strong>Covalent bonding:</strong> Formation of a stable monoadduct via alkylation at N7 of guanine.</li>
                <li><strong>Second alkylation:</strong> The second chloroethyl arm undergoes similar activation, forming another aziridinium ion that reacts with a guanine on the opposite DNA strand.</li>
                <li><strong>Cross-link formation:</strong> Bifunctional adduct creates an interstrand cross-link (primarily between N7 positions of guanines).</li>
            </ol>
        </div>
        
        <div class="nitrogen-mustard-highlight">
            <p>The aziridinium ion is a highly strained three-membered ring structure (angle strain ~60°) that makes nitrogen mustards exceptionally reactive toward nucleophilic sites in DNA. The N7 position of guanine is particularly susceptible due to its location in the major groove and high electron density.</p>
        </div>
        
        <p>The bifunctional nature of nitrogen mustards allows them to form cross-links between two guanine residues, typically on opposite strands of the DNA double helix with an optimal spacing of 8-9Å. These interstrand cross-links prevent strand separation during DNA replication, effectively halting the replication process and triggering apoptotic pathways through the DNA damage response system.</p>
        
        <div class="molecular-detail">
            <h3>Structural Determinants of Cross-Linking</h3>
            <p>The efficiency of cross-link formation depends on several factors:</p>
            <ul>
                <li><strong>Distance between reactive centers:</strong> The ~8-9Å spacing between chloroethyl groups matches the distance between N7 atoms of guanines in opposite strands.</li>
                <li><strong>Base sequence context:</strong> 5'-GNC-3' sequences are most susceptible due to optimal spatial alignment.</li>
                <li><strong>Steric accessibility:</strong> The N7 position of guanine is in the major groove, making it more accessible than other nucleophilic sites.</li>
                <li><strong>Electron density:</strong> The N7 lone pair has higher electron density than other potential targets (e.g., O6 of guanine).</li>
            </ul>
        </div>
    </div>

    <!-- Animation Section -->
    <div class="scene" id="nitrogen-mustard-mechanism">
        <h2>Nitrogen Mustard Animation</h2>
        
        <div class="mechanism-visualization">
            <svg id="nm-animation" width="100%" height="400" viewBox="0 0 800 400"></svg>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #007bff;"></div>
                <span>5'-3' Backbone (Blue)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #dc3545;"></div>
                <span>3'-5' Backbone (Red)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #F08080;"></div>
                <span>Adenine (A)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #F5D67D;"></div>
                <span>Thymine (T)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #58D68D;"></div>
                <span>Guanine (G)</span>
            </div>
             <div class="legend-item">
                <div class="legend-color" style="background: #5DADE2;"></div>
                <span>Cytosine (C)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #BDC3C7;"></div>
                <span>Hydrogen Bonds</span>
            </div>
        </div>
        
        <div class="explanation-box">
            <h3 id="nm-step-title">Nitrogen Mustard: Step 1</h3> 
            <p class="explanation-text" id="nm-explanation">The animation will demonstrate the step-by-step mechanism of nitrogen mustard action on DNA. Click "Next" to begin.</p>
        </div>
        
        <div class="navigation-buttons">
            <button id="nm-prev-btn" onclick="navigateTo('previous', 'nitrogen-mustard')">Previous Step</button>
            <button id="nm-next-btn" onclick="navigateTo('next', 'nitrogen-mustard')">Next Step</button>
            <button onclick="navigateTo('restart', 'nitrogen-mustard')">Restart</button>
        </div>
    </div>

    <!-- Biological Consequences Section -->
    <div class="scene">
        <h2>Biological Consequences of Alkylation</h2>
        
        <p>The formation of interstrand cross-links by nitrogen mustards has profound biological consequences at the molecular, cellular, and tissue levels:</p>
        
        <div class="key-points">
            <h3>Molecular Effects</h3>
            <ul>
                <li><strong>DNA distortion:</strong> Cross-links cause significant helical distortion (~30° bend) and local denaturation.</li>
                <li><strong>Replication blockage:</strong> The cross-links prevent DNA strand separation, halting the replication fork.</li>
                <li><strong>Transcription inhibition:</strong> RNA polymerase cannot traverse the damaged DNA region.</li>
                <li><strong>Base pairing disruption:</strong> Alkylated guanine can mispair with thymine during replication.</li>
            </ul>
        </div>
        
        <div class="activation-pathway">
            <h3>Cellular Response Pathway</h3>
            <ol>
                <li><strong>Damage recognition:</strong> ATM/ATR kinases detect DNA damage and phosphorylate downstream targets.</li>
                <li><strong>Cell cycle arrest:</strong> p53 activation leads to G1/S or G2/M arrest via p21 induction.</li>
                <li><strong>Repair attempts:</strong> Nucleotide excision repair (NER) and homologous recombination (HR) pathways are activated.</li>
                <li><strong>Repair failure:</strong> Persistent cross-links overwhelm repair capacity (especially in rapidly dividing cells).</li>
                <li><strong>Apoptotic signaling:</strong> Mitochondrial outer membrane permeabilization releases cytochrome c.</li>
                <li><strong>Caspase activation:</strong> Cytochrome c binds with Apaf-1 to form the apoptosome, activating caspase-9.</li>
                <li><strong>Execution phase:</strong> Caspase cascade (3, 6, 7) mediates proteolytic cleavage of cellular components.</li>
            </ol>
        </div>
        
        <div class="molecular-detail">
            <h3>Clinical Implications</h3>
            <p>The therapeutic index of nitrogen mustards depends on several factors:</p>
            <ul>
                <li><strong>Proliferation rate:</strong> Rapidly dividing cells (cancer, immune, gut epithelium) are most sensitive.</li>
                <li><strong>Repair capacity:</strong> Cells with deficient DNA repair (e.g., BRCA mutations) show increased sensitivity.</li>
                <li><strong>Cell cycle phase:</strong> Greatest efficacy in late G1 and S phases when DNA is replicating.</li>
                <li><strong>Resistance mechanisms:</strong> Includes increased DNA repair, glutathione conjugation, and decreased drug uptake.</li>
            </ul>
        </div>
    </div>

<script>
    document.getElementById('img1').addEventListener('click', function() {
      document.getElementById('img2').style.display = 'block';
    });

document.addEventListener('DOMContentLoaded', () => {
    const sidebar = document.querySelector(".sidebar");
    const sidebarToggle = document.querySelector('.sidebar-toggle');
    const navLinks = document.querySelectorAll(".nav-links > li > a"); // Target direct links within list items
    const hasSubmenuItems = document.querySelectorAll('.has-submenu');
    const subLinks = document.querySelectorAll('.sub-links a');

    // Sidebar toggle logic
    if (sidebarToggle && sidebar) {
        sidebarToggle.addEventListener('click', function () {
            sidebar.classList.toggle('active');
            localStorage.setItem('sidebarExpanded', sidebar.classList.contains('active'));
        });

        // Restore state
        if (localStorage.getItem('sidebarExpanded') === 'true') {
            sidebar.classList.add('active');
        }
    }

    // Submenu toggle
    hasSubmenuItems.forEach(item => {
        const link = item.querySelector('a');
        if (link) {
            link.addEventListener('click', function (e) {
                e.preventDefault();
                item.classList.toggle('active');
            });
        }
    });

    // Close sidebar when a submenu link is clicked
    subLinks.forEach(subLink => {
        subLink.addEventListener('click', () => {
            sidebar.classList.remove("active");
            localStorage.setItem('sidebarExpanded', 'false');
        });
    });

    // Close sidebar when a top-level (non-submenu) link is clicked
    navLinks.forEach(link => {
        link.addEventListener("click", () => {
            if (!link.parentElement.classList.contains('has-submenu')) { // Check the parent LI
                sidebar.classList.remove("active");
                localStorage.setItem('sidebarExpanded', 'false');
            }
        });
    });

        // Initialize animation
        initializeNitrogenMustardAnimation();
    });

    // SVG namespace
    const svgNS = "http://www.w3.org/2000/svg";
    
    // Animation state
    const currentStep = {
        'nitrogen-mustard': 0
    };
    
    const mechanisms = {
        'nitrogen-mustard': {
            steps: [
                `<b>Step 1: Nitrogen Mustard Structure</b><br>The nitrogen mustard molecule (e.g., mechlorethamine) features a central tertiary nitrogen with two chloroethyl groups (-CH<sub>2</sub>CH<sub>2</sub>Cl) that serve as the reactive arms. The molecule is in its stable, unactivated form with chloride leaving groups.`,
                `<b>Step 2: Aziridinium Ion Formation</b><br>The nitrogen's lone pair initiates intramolecular cyclization (SN2 reaction), displacing a chloride ion and forming a highly reactive, strained three-membered aziridinium ring (lifetime ~0.1 sec). This intermediate is strongly electrophilic due to angle strain (~60°) and positive charge.`,
                `<b>Step 3: First Alkylation Event</b><br>The aziridinium ion is attacked by the nucleophilic N7 atom (pKa ~3.5) of a guanine base in the major groove of DNA. This forms a stable monoadduct via N7-alkylation (k<sub>alkyl</sub> ~10<sup>-3</sup> s<sup>-1</sup> at physiological pH).`,
                `<b>Step 4: Second Alkylation & Cross-link Formation</b><br>The second chloroethyl arm undergoes similar activation, forming another aziridinium ion that reacts with a guanine on the opposite DNA strand (optimal spacing 8-9Å), creating an interstrand cross-link. The cross-link primarily forms at 5'-GNC-3' sequences.`,
                `<b>Step 5: Biological Consequences</b><br>The cross-link prevents DNA strand separation during replication, causing replication fork collapse. The distortion (~30° bend) triggers the DNA damage response (ATM/ATR activation) and ultimately leads to apoptosis via the intrinsic pathway.`
            ],
            animations: [
                showNitrogenMustardStructure,
                showAziridiniumFormation,
                showFirstAlkylation,
                showCrosslinkFormation,
                showBiologicalConsequences
            ]
        }
    };

    // Initialize the nitrogen mustard animation
    function initializeNitrogenMustardAnimation() {
        updateMechanism('nitrogen-mustard');
    }

    function updateMechanism(agent) {
        const stepsData = mechanisms[agent];
        const stepIndex = currentStep[agent];
        const explanationTitle = document.getElementById('nm-step-title');
        const explanationText = document.getElementById('nm-explanation');
        const nextButton = document.getElementById('nm-next-btn');
        const prevButton = document.getElementById('nm-prev-btn');

        if (!stepsData) return;

        explanationTitle.innerHTML = `Nitrogen Mustard: Step ${stepIndex + 1}`;
        explanationText.innerHTML = stepsData.steps[stepIndex];

        // Update button states
        prevButton.disabled = stepIndex === 0;
        nextButton.disabled = stepIndex === stepsData.steps.length - 1;
        if (stepIndex === stepsData.steps.length - 1) {
            nextButton.textContent = "Complete";
        } else {
            nextButton.textContent = "Next Step";
        }

        // Clear previous animation
        clearSVG('nm-animation');

        // Run the current step's animation
        if (stepsData.animations[stepIndex]) {
            stepsData.animations[stepIndex]();
        }
    }

    function createLabel(svg, id, x, y, textContent) {
        const label = document.createElementNS(svgNS, 'text');
        label.setAttribute('id', id);
        label.setAttribute('x', x);
        label.setAttribute('y', y);
        label.setAttribute('text-anchor', 'middle');
        label.setAttribute('font-size', '14px');
        label.setAttribute('fill', '#333');
        label.textContent = textContent;
        svg.appendChild(label);
        gsap.set(label, { opacity: 0 });
        return label;
    }

    // Generic bond for cross-links etc.
    function createGenericBond(svg, id, x1, y1, x2, y2, stroke = '#C0392B', strokeWidth = 3) {
        const line = document.createElementNS(svgNS, 'line');
        line.setAttribute('id', id);
        line.setAttribute('x1', x1); line.setAttribute('y1', y1);
        line.setAttribute('x2', x1); // Start as point, animate to x2
        line.setAttribute('y2', y1); // Start as point, animate to y2
        line.setAttribute('stroke', stroke);
        line.setAttribute('stroke-width', strokeWidth);
        svg.appendChild(line);
        gsap.set(line, { opacity: 0 });
        return line;
    }

    function navigateTo(action, agent) {
        let stepIndex = currentStep[agent];
        const maxSteps = mechanisms[agent].steps.length - 1;

        if (action === 'next' && stepIndex < maxSteps) {
            currentStep[agent]++;
        } else if (action === 'previous' && stepIndex > 0) {
            currentStep[agent]--;
        } else if (action === 'restart') {
            currentStep[agent] = 0;
        }

        updateMechanism(agent);
    }

    function clearSVG(svgId) {
        const svg = document.getElementById(svgId);
        while (svg.firstChild) {
            svg.removeChild(svg.firstChild);
        }
    }

    // Animation Steps
    function showNitrogenMustardStructure() {
        const svg = document.getElementById('nm-animation');
        const centerX = 400;
        const centerY = 100;
        
        // Create nitrogen mustard molecule
        const nmGroup = document.createElementNS(svgNS, 'g');
        nmGroup.setAttribute('id', 'nm-molecule');
        svg.appendChild(nmGroup);
        
        // Central nitrogen
        const nitrogen = createAtom(nmGroup, 'N', centerX, centerY, '#8E44AD', 'N', 12);
        
        // Chloroethyl arms
        const leftArm = createChloroethylArm(nmGroup, 'left', centerX - 30, centerY, '#1a2980');
        const rightArm = createChloroethylArm(nmGroup, 'right', centerX + 30, centerY, '#1a2980');
        
        // Bonds
        createBond(nmGroup, centerX - 12, centerY, centerX + 12, centerY, '#333', 2);
        
        // Animation
        gsap.from([nitrogen, ...leftArm.elements, ...rightArm.elements], {
            opacity: 0,
            scale: 0.8,
            duration: 0.7,
            ease: "back.out(1.7)",
            stagger: 0.1
        });
    }

    function showAziridiniumFormation() {
        const svg = document.getElementById('nm-animation');
        const centerX = 400;
        const centerY = 100;
        
        // Create initial nitrogen mustard
        const nmGroup = document.createElementNS(svgNS, 'g');
        nmGroup.setAttribute('id', 'nm-molecule');
        svg.appendChild(nmGroup);
        
        const nitrogen = createAtom(nmGroup, 'N', centerX, centerY, '#8E44AD', 'N', 12);
        const leftArm = createChloroethylArm(nmGroup, 'left', centerX - 30, centerY, '#1a2980');
        createBond(nmGroup, centerX - 12, centerY, centerX + 12, centerY, '#333', 2);
        
        // Create aziridinium ion
        const aziridinium = createAziridiniumIon(svg, 'aziridinium', centerX, centerY);
        
        // Create chloride ion
        const chloride = createAtom(svg, 'Cl', centerX - 80, centerY, '#1ABC9C', 'Cl⁻', 10);
        
        // Animation timeline
        const tl = gsap.timeline();
        
        // Show initial molecule
        tl.set([nitrogen, ...leftArm.elements], { opacity: 1, scale: 1 });
        
        // Animate aziridinium formation
        tl.to(leftArm.chlorine, { 
            x: -50, 
            opacity: 0, 
            duration: 0.5 
        }, "+=0.3")
        .to(leftArm.chlorineLabel, { opacity: 0, duration: 0.3 }, "<")
        .to(leftArm.bond, { opacity: 0, duration: 0.3 }, "<")
        .fromTo(aziridinium.elements, 
            { opacity: 0, scale: 0.8 }, 
            { opacity: 1, scale: 1, duration: 0.7, ease: "elastic.out(1, 0.5)" }, "<")
        .fromTo(aziridinium.ring, 
            { strokeWidth: 2 }, 
            { strokeWidth: 4, duration: 0.3, repeat: 3, yoyo: true, ease: "power1.inOut" }, "+=0.2")
        .fromTo(chloride, 
            { opacity: 0, x: centerX }, 
            { opacity: 1, x: centerX - 80, duration: 0.5, ease: "power1.out" }, "-=0.3");
    }

    function showFirstAlkylation() {
    const svg = document.getElementById('nm-animation');
    const centerX = 200;
    const centerY = 200; // Adjusted centerY for vertical DNA

    // Create aziridinium ion
    const aziridinium = createAziridiniumIon(svg, 'aziridinium', centerX - 100, centerY - 50); // Adjusted position

    // Create detailed DNA segment with highlighted guanine
    const dna = createDetailedDNAStrands(svg, 'dna', centerX + 100, centerY - 100, 300);
    const targetGuanineBase1 = dna.group.querySelector('#dna-base1-2'); // Assuming the 3rd base (index 2) on strand 1 is Guanine
    const targetGuanineBase2 = dna.group.querySelector('#dna-base2-2');

    // Get the bounding box and center of the target guanine
    const guanineRect1 = targetGuanineBase1.getBoundingClientRect();
    const guanineRect2 = targetGuanineBase2.getBoundingClientRect();
    const svgRect = svg.getBoundingClientRect();

    const guanineCenterX1 = guanineRect1.left + guanineRect1.width / 2 - svgRect.left;
    const guanineCenterY1 = guanineRect1.top + guanineRect1.height / 2 - svgRect.top;
    const guanineCenterX2 = guanineRect2.left + guanineRect2.width / 2 - svgRect.left;
    const guanineCenterY2 = guanineRect2.top + guanineRect2.height / 2 - svgRect.top;

    // Create N7 position marker (adjust position based on the detailed DNA)
    const n7Position1 = createN7Position(svg, parseFloat(targetGuanineBase1.dataset.n7x), parseFloat(targetGuanineBase1.dataset.n7y), '#FF5722');

    // Animation timeline
    const tl = gsap.timeline();

    // Show initial elements
    tl.set([...aziridinium.elements, dna.group], { opacity: 1, scale: 1 });

    // Highlight guanine and N7 position
    tl.to(targetGuanineBase1, { fill: '#FFEB3B', duration: 0.5 })
        .fromTo(n7Position1, { opacity: 0, scale: 0.5 }, { opacity: 1, scale: 1, duration: 0.5, ease: "back.out(1.7)" }, "<")
        .to(n7Position1, { fill: '#FF9800', duration: 0.3, repeat: 2, yoyo: true }, "+=0.3");

    // Move aziridinium to guanine
    const aziridiniumBox = aziridinium.group.getBoundingClientRect();
    const aziridiniumCenterX = aziridiniumBox.left + aziridiniumBox.width / 2 - svgRect.left;
    const aziridiniumCenterY = aziridiniumBox.top + aziridiniumBox.height / 2 - svgRect.top;

    const moveX = guanineCenterX1 - aziridiniumCenterX - 10; // Adjust as needed
    const moveY = guanineCenterY1 - aziridiniumCenterY;

    tl.to(aziridinium.group, { x: '+= ' + moveX, y: '+= ' + moveY, duration: 0.8, ease: "power2.inOut" });

    // Create covalent bond
    const bondStartX = parseFloat(targetGuanineBase1.dataset.n7x);
    const bondStartY = parseFloat(targetGuanineBase1.dataset.n7y);
    const bondEndX = guanineCenterX1 - 5; // Adjust as needed
    const bondEndY = guanineCenterY1;

    const bond = createBond(svg, 'alkyl-bond', bondStartX, bondStartY, bondEndX, bondEndY, '#D32F2F', 3);
    tl.fromTo(bond, { opacity: 0, strokeWidth: 1 }, { opacity: 1, strokeWidth: 3, duration: 0.5 });

    // Show remaining chloroethyl arm
    tl.to(aziridinium.remainingArm, { opacity: 1, duration: 0.5 });
}

function showCrosslinkFormation() {
    const svg = document.getElementById('nm-animation');
    const centerX = 300;
    const centerY = 200;

    // Create detailed DNA with first alkylation
    const dna = createDetailedDNAStrands(svg, 'dna-crosslink', centerX, centerY - 150, 400, 10);
    const firstGuanineBase1 = dna.group.querySelector('#dna-crosslink-base1-2'); // Assuming the 3rd base (index 2) on strand 1 is first G
    const secondGuanineBase2 = dna.group.querySelector('#dna-crosslink-base2-6'); // Assuming the 7th base (index 6) on strand 2 is second G

    // Get bounding boxes and centers
    const firstGuanineRect = firstGuanineBase1.getBoundingClientRect();
    const secondGuanineRect = secondGuanineBase2.getBoundingClientRect();
    const svgRect = svg.getBoundingClientRect();

    const firstGuanineCenterX = firstGuanineRect.left + firstGuanineRect.width / 2 - svgRect.left;
    const firstGuanineCenterY = firstGuanineRect.top + firstGuanineRect.height / 2 - svgRect.top;
    const secondGuanineCenterX = secondGuanineRect.left + secondGuanineRect.width / 2 - svgRect.left;
    const secondGuanineCenterY = secondGuanineRect.top + secondGuanineRect.height / 2 - svgRect.top;

    // Create attached mustard (first alkylation) - adjust position
    const attachedMustard = createAttachedMustard(svg, 'attached-mustard', firstGuanineCenterX - 40, firstGuanineCenterY - 20);

    // Create first bond
    const firstBondStartX = parseFloat(firstGuanineBase1.dataset.n7x);
    const firstBondStartY = parseFloat(firstGuanineBase1.dataset.n7y);
    const firstBondEndX = firstGuanineCenterX - 10;
    const firstBondEndY = firstGuanineCenterY;
    const firstBond = createBond(svg, 'first-bond', firstBondStartX, firstBondStartY, firstBondEndX, firstBondEndY, '#7B1FA2', 2);

    // Animation timeline
    const tl = gsap.timeline();

    // Show initial elements
    tl.set([...dna.elements, attachedMustard.group, firstBond], { opacity: 1 });
    tl.to(firstGuanineBase1, { fill: '#FFEB3B' });
    tl.to(secondGuanineBase2, { fill: '#FFEB3B', duration: 0.5 });

    // Animate second alkylation
    const remainingCl = attachedMustard.group.querySelector('#attached-mustard-cl');
    const remainingClLabel = attachedMustard.group.querySelector('#attached-mustard-cl-label');
    const remainingBond = attachedMustard.group.querySelector('#attached-mustard-bond');

    tl.to([remainingCl, remainingClLabel, remainingBond], { opacity: 0, duration: 0.4 }, "+=0.5")
        .call(() => {
            // Create crosslink
            const crosslinkStartX = firstGuanineCenterX + 10;
            const crosslinkStartY = firstGuanineCenterY;
            const crosslinkEndX = parseFloat(secondGuanineBase2.dataset.n7x);
            const crosslinkEndY = parseFloat(secondGuanineBase2.dataset.n7y);
            const crosslink = createBond(svg, 'crosslink', crosslinkStartX, crosslinkStartY, crosslinkEndX, crosslinkEndY, '#D32F2F', 4);
            gsap.fromTo(crosslink, { opacity: 0, strokeWidth: 1 }, { opacity: 1, strokeWidth: 4, duration: 0.7, ease: "elastic.out(1, 0.5)" });

            // Show DNA distortion (simplified for vertical DNA)
            // You might need a more sophisticated way to distort a vertical helix
            gsap.to([dna.path1, dna.path2], {
                attr: {
                    d: (i, el, context) => {
                        const path = el.getAttribute('d');
                        const segments = path.split('L');
                        const distortedSegments = segments.map((seg, index) => {
                            if (index > 0) {
                                const coords = seg.split(',').map(Number);
                                // Apply a subtle horizontal shift around the crosslink
                                if (coords[1] > firstGuanineCenterY - 50 && coords[1] < secondGuanineCenterY + 50) {
                                    coords[0] += Math.sin((coords[1] - firstGuanineCenterY) * 0.05) * 10;
                                }
                                return `L${coords[0]},${coords[1]}`;
                            }
                            return seg;
                        }).join('');
                        return distortedSegments;
                    }
                },
                duration: 1,
                ease: "elastic.out(1, 0.3)"
            });
        });
}

function showBiologicalConsequences() {
    const svg = document.getElementById('nm-animation');
    const centerX = 400;
    const centerY = 200;

    // Create DNA with crosslink
    const dna = createDetailedDNAStrands(svg, 'dna-damage', centerX - 150, centerY - 180, 450, 12);
    const guanines = dna.group.querySelectorAll('[id*="dna-damage-base1-"],[id*="dna-damage-base2-"]');
    const g1Base1 = Array.from(guanines).find(g => g.id === 'dna-damage-base1-3'); // Example G on strand 1
    const g2Base2 = Array.from(guanines).find(g => g.id === 'dna-damage-base2-8'); // Example G on strand 2

    if (!g1Base1 || !g2Base2) {
        console.error("Could not find target guanines for crosslink in biological consequences.");
        return;
    }

    const g1Rect = g1Base1.getBoundingClientRect();
    const g2Rect = g2Base2.getBoundingClientRect();
    const svgRect = svg.getBoundingClientRect();

    const g1CenterX = g1Rect.left + g1Rect.width / 2 - svgRect.left;
    const g1CenterY = g1Rect.top + g1Rect.height / 2 - svgRect.top;
    const g2CenterX = g2Rect.left + g2Rect.width / 2 - svgRect.left;
    const g2CenterY = g2Rect.top + g2Rect.height / 2 - svgRect.top;

    // Create crosslink
    const crosslink = createBond(svg, 'crosslink-bio', g1CenterX + 5, g1CenterY, parseFloat(g2Base2.dataset.n7x) - 5, parseFloat(g2Base2.dataset.n7y), '#D32F2F', 4);

    // Create replication fork (adjust position for vertical DNA)
    const replicationFork = createReplicationFork(svg, centerX + 150, centerY);

    // Animation timeline
    const tl = gsap.timeline();

    // Show DNA with crosslink
    tl.set([...dna.elements, crosslink], { opacity: 1 })
        .to([g1Base1, g2Base2], { fill: '#FFEB3B', duration: 0.3 });

    // Show replication fork approaching
    tl.to(replicationFork.elements, { x: centerX - 50, duration: 1.5, ease: "power1.inOut" })
        .to(replicationFork.elements, { opacity: 0, duration: 0.5 }, "+=0.5")
        .call(() => {
            // Show damage response proteins (adjust position)
            const damageProteins = createDamageResponseProteins(svg, centerX - 100, centerY + 50);
            gsap.fromTo(damageProteins.elements, { opacity: 0, scale: 0.8 }, { opacity: 1, scale: 1, duration: 0.7, stagger: 0.1 });

            // Show apoptotic cascade (adjust position)
            const apoptoticElements = createApoptoticCascade(svg, centerX + 100, centerY + 100);
            gsap.fromTo(apoptoticElements.elements, { opacity: 0, y: 20 }, { opacity: 1, y: 0, duration: 0.5, stagger: 0.1, delay: 0.5 });
        });
}

    // Helper functions for creating SVG elements
    function createAtom(parent, id, x, y, color, label, radius = 10) {
        const circle = document.createElementNS(svgNS, 'circle');
        circle.setAttribute('id', id);
        circle.setAttribute('cx', x);
        circle.setAttribute('cy', y);
        circle.setAttribute('r', radius);
        circle.setAttribute('fill', color);
        circle.setAttribute('stroke', '#333');
        circle.setAttribute('stroke-width', '1');
        parent.appendChild(circle);
        
        if (label) {
            const text = document.createElementNS(svgNS, 'text');
            text.setAttribute('x', x);
            text.setAttribute('y', y);
            text.setAttribute('text-anchor', 'middle');
            text.setAttribute('dy', '.3em');
            text.setAttribute('font-size', radius * 0.8);
            text.setAttribute('fill', 'white');
            text.textContent = label;
            parent.appendChild(text);
            return [circle, text];
        }
        
        return circle;
    }

    function createChloroethylArm(parent, id, x, y, color) {
        const group = document.createElementNS(svgNS, 'g');
        group.setAttribute('id', `arm-${id}`);
        parent.appendChild(group);
        
        const elements = [];
        
        // Carbon atoms
        const c1 = createAtom(group, `${id}-c1`, x, y, '#5D6D7E', 'C', 8);
        const c2 = createAtom(group, `${id}-c2`, x + 20, y, '#5D6D7E', 'C', 8);
        elements.push(...c1, ...c2);
        
        // Bond between carbons
        const bond1 = createBond(group, x + 8, y, x + 12, y, '#333', 2);
        elements.push(bond1);
        
        // Chlorine
        const chlorine = createAtom(group, `${id}-cl`, x + 35, y, '#1ABC9C', 'Cl', 9);
        const clLabel = group.querySelector(`#${id}-cl text`);
        
        // Bond to chlorine
        const bond2 = createBond(group, x + 28, y, x + 35, y, '#333', 2);
        
        return {
            elements,
            chlorine,
            chlorineLabel: clLabel,
            bond: bond2
        };
    }

    function createBond(parent, x1, y1, x2, y2, color, width) {
        const line = document.createElementNS(svgNS, 'line');
        line.setAttribute('x1', x1);
        line.setAttribute('y1', y1);
        line.setAttribute('x2', x2);
        line.setAttribute('y2', y2);
        line.setAttribute('stroke', color);
        line.setAttribute('stroke-width', width);
        line.setAttribute('stroke-linecap', 'round');
        parent.appendChild(line);
        return line;
    }

    function createAziridiniumIon(parent, id, x, y) {
        const group = document.createElementNS(svgNS, 'g');
        group.setAttribute('id', id);
        group.setAttribute('transform', `translate(${x},${y})`);
        parent.appendChild(group);
        
        const elements = [];
        
        // Nitrogen
        const nitrogen = createAtom(group, `${id}-n`, 0, 0, '#E74C3C', 'N+', 10);
        elements.push(...nitrogen);
        
        // Aziridinium ring
        const ring = document.createElementNS(svgNS, 'path');
        ring.setAttribute('d', 'M -10 10 Q 0 -10 10 10');
        ring.setAttribute('fill', 'none');
        ring.setAttribute('stroke', '#8E44AD');
        ring.setAttribute('stroke-width', '3');
        ring.setAttribute('stroke-linejoin', 'round');
        group.appendChild(ring);
        elements.push(ring);
        
        // Carbon atoms
        const c1 = createAtom(group, `${id}-c1`, -10, 10, '#5D6D7E', 'C', 8);
        const c2 = createAtom(group, `${id}-c2`, 10, 10, '#5D6D7E', 'C', 8);
        elements.push(...c1, ...c2);
        
        // Remaining chloroethyl arm
        const remainingArm = createChloroethylArm(group, `${id}-remaining`, 0, 0, '#1a2980');
        gsap.set(remainingArm.elements, { opacity: 0 });
        
        return {
            group,
            elements,
            ring,
            nitrogenAtom: nitrogen[0],
            remainingArm: remainingArm.elements
        };
    }

    function createDetailedDNAStrands(svg, idPrefix, x_center, y_offset, overall_height, numSegments = 5) { // Modified parameters
        const group = document.createElementNS(svgNS, 'g');
        group.setAttribute('id', `${idPrefix}-dna-helix`);
        svg.appendChild(group);

        // Parameters based on the reference image and new vertical orientation
        const amplitude = 40;      // Horizontal spread of the helix
        const frequency = 0.025;   // Waves per unit of height (adjust for twist density)
        const segmentStep = 2;     // Step for drawing path points

        // Color Palette from reference image
        const backboneColorBlue = '#007bff'; // A clear blue
        const backboneColorRed = '#dc3545';   // A clear red
        const adenineColor = '#F08080';     // Light Coral / Pinkish-Red for A
        const thymineColor = '#F5D67D';       // Yellow/Orange for T
        const guanineColor = '#58D68D';       // Green for G (current is good)
        const cytosineColor = '#5DADE2';      // Light blue for C
        const hBondColor = '#BDC3C7';         // Light grey for H-bonds
        const labelColor = '#333';            // For 5'/3' and base letters

        const backboneWidth = 5;
        const baseRectWidthPurine = 18; // A, G
        const baseRectHeightPurine = 10;
        const baseRectWidthPyrimidine = 14; // C, T
        const baseRectHeightPyrimidine = 10;
        const baseFontSize = "8px";

        const allElements = [];
        
        // Define a sample base sequence for one strand
        const sequence = ['A', 'T', 'G', 'C', 'G', 'T', 'A', 'C', 'G', 'A']; 
        const numBasePairs = sequence.length;
        const basePairSpacing = overall_height / (numBasePairs + 1);

        // Create the two backbone strands (Vertical Orientation)
        const strandBlue = document.createElementNS(svgNS, 'path'); // Left strand (5'-3' top to bottom)
        const strandRed = document.createElementNS(svgNS, 'path');   // Right strand (3'-5' top to bottom)
        
        let dBlue = '';
        let dRed = '';
        const startY = y_offset;
        const endY = y_offset + overall_height;

        for (let currentY = startY; currentY <= endY; currentY += segmentStep) {
            const xBlue = x_center - amplitude * Math.cos(frequency * (currentY - startY)); // Cosine for side-to-side start
            const xRed  = x_center - amplitude * Math.cos(frequency * (currentY - startY) + Math.PI); // 180deg phase offset
            
            if (currentY === startY) {
                dBlue += `M${xBlue},${currentY}`;
                dRed += `M${xRed},${currentY}`;
            } else {
                dBlue += ` L${xBlue},${currentY}`;
                dRed += ` L${xRed},${currentY}`;
            }
        }
        
        strandBlue.setAttribute('d', dBlue);
        strandBlue.setAttribute('stroke', backboneColorBlue);
        strandBlue.setAttribute('stroke-width', backboneWidth);
        strandBlue.setAttribute('fill', 'none');
        strandBlue.addEventListener('mouseenter', (e) => showAnimationTooltip(e, '<b>5\'-3\' DNA Backbone</b><br>(Blue Strand)'));
        strandBlue.addEventListener('mouseleave', hideAnimationTooltip);
        group.appendChild(strandBlue);
        allElements.push(strandBlue);
        
        strandRed.setAttribute('d', dRed);
        strandRed.setAttribute('stroke', backboneColorRed);
        strandRed.setAttribute('stroke-width', backboneWidth);
        strandRed.setAttribute('fill', 'none');
        strandRed.addEventListener('mouseenter', (e) => showAnimationTooltip(e, '<b>3\'-5\' DNA Backbone</b><br>(Red Strand)'));
        strandRed.addEventListener('mouseleave', hideAnimationTooltip);
        group.appendChild(strandRed);
        allElements.push(strandRed);

        // Add 5' and 3' labels
        const fivePrimeBlue = createLabel(svg, `${idPrefix}-5pb`, x_center - amplitude - 15, startY, "5'");
        const threePrimeBlue = createLabel(svg, `${idPrefix}-3pb`, x_center - amplitude * Math.cos(frequency * overall_height) - 15, endY + 15, "3'");
        const threePrimeRed = createLabel(svg, `${idPrefix}-3pr`, x_center - amplitude * Math.cos(Math.PI) + 15, startY, "3'");
        const fivePrimeRed = createLabel(svg, `${idPrefix}-5pr`, x_center - amplitude * Math.cos(frequency * overall_height + Math.PI) + 15, endY + 15, "5'");
        gsap.set([fivePrimeBlue, threePrimeBlue, threePrimeRed, fivePrimeRed], {opacity: 1, fill: labelColor, fontSize: "12px", fontWeight:"bold"});
        allElements.push(fivePrimeBlue, threePrimeBlue, threePrimeRed, fivePrimeRed);
        
        // Create base pairs
        for (let i = 0; i < numBasePairs; i++) {
            const currentY = y_offset + (i + 1) * basePairSpacing;
            const xBlue = x_center - amplitude * Math.cos(frequency * (currentY - startY));
            const xRed  = x_center - amplitude * Math.cos(frequency * (currentY - startY) + Math.PI);

            const baseTypeStrand1 = sequence[i];
            let baseTypeStrand2, color1, color2, width1, height1, width2, height2, label1, label2;
            let tooltip1, tooltip2;

            switch (baseTypeStrand1) {
                case 'A':
                    baseTypeStrand2 = 'T'; color1 = adenineColor; color2 = thymineColor;
                    width1 = baseRectWidthPurine; height1 = baseRectHeightPurine;
                    width2 = baseRectWidthPyrimidine; height2 = baseRectHeightPyrimidine;
                    label1 = 'A'; label2 = 'T';
                    tooltip1 = '<b>Adenine (A)</b>'; tooltip2 = '<b>Thymine (T)</b>';
                    break;
                case 'T':
                    baseTypeStrand2 = 'A'; color1 = thymineColor; color2 = adenineColor;
                    width1 = baseRectWidthPyrimidine; height1 = baseRectHeightPyrimidine;
                    width2 = baseRectWidthPurine; height2 = baseRectHeightPurine;
                    label1 = 'T'; label2 = 'A';
                    tooltip1 = '<b>Thymine (T)</b>'; tooltip2 = '<b>Adenine (A)</b>';
                    break;
                case 'G':
                    baseTypeStrand2 = 'C'; color1 = guanineColor; color2 = cytosineColor;
                    width1 = baseRectWidthPurine; height1 = baseRectHeightPurine;
                    width2 = baseRectWidthPyrimidine; height2 = baseRectHeightPyrimidine;
                    label1 = 'G'; label2 = 'C';
                    tooltip1 = '<b>Guanine (G)</b><br>Target for alkylation.'; tooltip2 = '<b>Cytosine (C)</b>';
                    break;
                case 'C':
                    baseTypeStrand2 = 'G'; color1 = cytosineColor; color2 = guanineColor;
                    width1 = baseRectWidthPyrimidine; height1 = baseRectHeightPyrimidine;
                    width2 = baseRectWidthPurine; height2 = baseRectHeightPurine;
                    label1 = 'C'; label2 = 'G';
                    tooltip1 = '<b>Cytosine (C)</b>'; tooltip2 = '<b>Guanine (G)</b><br>Target for alkylation.';
                    break;
            }

            // Base on Blue Strand (Strand 1)
            const base1 = document.createElementNS(svgNS, 'rect');
            base1.setAttribute('id', `${idPrefix}-base1-${i}`);
            base1.setAttribute('x', xBlue - (baseTypeStrand1 === 'A' || baseTypeStrand1 === 'G' ? width1/2 : width1/2)); // Centered on backbone
            base1.setAttribute('y', currentY - height1/2);
            base1.setAttribute('width', width1);
            base1.setAttribute('height', height1);
            base1.setAttribute('fill', color1);
            base1.setAttribute('rx', 2); base1.setAttribute('ry', 2);
            base1.addEventListener('mouseenter', (e) => showAnimationTooltip(e, tooltip1));
            base1.addEventListener('mouseleave', hideAnimationTooltip);
            group.appendChild(base1);
            allElements.push(base1);

            const baseLabel1 = createLabel(svg, `${idPrefix}-b1label-${i}`, xBlue, currentY + baseFontSize/2.5 , label1);
            gsap.set(baseLabel1, {opacity:1, fill:"white", fontSize: baseFontSize, pointerEvents: 'none'});
            allElements.push(baseLabel1);


            // Base on Red Strand (Strand 2)
            const base2 = document.createElementNS(svgNS, 'rect');
            base2.setAttribute('id', `${idPrefix}-base2-${i}`);
            base2.setAttribute('x', xRed - (baseTypeStrand2 === 'A' || baseTypeStrand2 === 'G' ? width2/2 : width2/2)); // Centered on backbone
            base2.setAttribute('y', currentY - height2/2);
            base2.setAttribute('width', width2);
            base2.setAttribute('height', height2);
            base2.setAttribute('fill', color2);
            base2.setAttribute('rx', 2); base2.setAttribute('ry', 2);
            base2.addEventListener('mouseenter', (e) => showAnimationTooltip(e, tooltip2));
            base2.addEventListener('mouseleave', hideAnimationTooltip);
            group.appendChild(base2);
            allElements.push(base2);
            
            const baseLabel2 = createLabel(svg, `${idPrefix}-b2label-${i}`, xRed, currentY + baseFontSize/2.5, label2);
            gsap.set(baseLabel2, {opacity:1, fill:"white", fontSize: baseFontSize, pointerEvents: 'none'});
            allElements.push(baseLabel2);

            // Hydrogen Bonds (simplified as single line)
            const hBond = document.createElementNS(svgNS, 'line');
            hBond.setAttribute('x1', xBlue);
            hBond.setAttribute('y1', currentY);
            hBond.setAttribute('x2', xRed);
            hBond.setAttribute('y2', currentY);
            hBond.setAttribute('stroke', hBondColor);
            hBond.setAttribute('stroke-width', '2');
            hBond.addEventListener('mouseenter', (e) => showAnimationTooltip(e, '<b>Hydrogen Bonds</b>'));
            hBond.addEventListener('mouseleave', hideAnimationTooltip);
            group.appendChild(hBond);
            allElements.push(hBond);
            
            // Store guanine N7 positions if it's a guanine for alkylation targeting
            if (baseTypeStrand1 === 'G') {
                base1.dataset.n7x = xBlue + (width1 / 2) * 0.6; // Approx N7 on outer edge
                base1.dataset.n7y = currentY;
            }
            if (baseTypeStrand2 === 'G') {
                base2.dataset.n7x = xRed - (width2 / 2) * 0.6; // Approx N7 on outer edge
                base2.dataset.n7y = currentY;
            }
        }
        
        gsap.set(allElements, { opacity: 0, scale: 0.9, transformOrigin: "center center" });
        return { group, elements: allElements, path1: strandBlue, path2: strandRed }; 
    }

    function createDNABase(parent, id, x, y, baseType, strand, position) {
        const colors = {
            'A': '#F08080',
            'T': '#F5D67D',
            'G': '#58D68D',
            'C': '#5DADE2'
        };
        
        const rect = document.createElementNS(svgNS, 'rect');
        rect.setAttribute('id', id);
        rect.setAttribute('x', x);
        rect.setAttribute('y', y - 8);
        rect.setAttribute('width', 10);
        rect.setAttribute('height', 16);
        rect.setAttribute('rx', 2);
        rect.setAttribute('ry', 2);
        rect.setAttribute('fill', colors[baseType]);
        parent.appendChild(rect);
        
        const text = document.createElementNS(svgNS, 'text');
        text.setAttribute('x', x + 5);
        text.setAttribute('y', y + 5);
        text.setAttribute('text-anchor', 'middle');
        text.setAttribute('font-size', '10');
        text.setAttribute('fill', 'white');
        text.textContent = baseType;
        parent.appendChild(text);
        
        return {
            element: rect,
            text,
            baseType,
            strand,
            position,
            x: x + (strand === 1 ? 5 : -5),
            y
        };
    }

    function createN7Position(parent, x, y, color) {
        const circle = document.createElementNS(svgNS, 'circle');
        circle.setAttribute('cx', x);
        circle.setAttribute('cy', y);
        circle.setAttribute('r', 4);
        circle.setAttribute('fill', color);
        circle.setAttribute('stroke', 'white');
        circle.setAttribute('stroke-width', '1');
        parent.appendChild(circle);
        return circle;
    }

    function createAttachedMustard(parent, id, x, y) {
        const group = document.createElementNS(svgNS, 'g');
        group.setAttribute('id', id);
        group.setAttribute('transform', `translate(${x},${y})`);
        parent.appendChild(group);
        
        // Nitrogen with one arm
        const nitrogen = createAtom(group, `${id}-n`, 0, 0, '#8E44AD', 'N', 10);
        
        // Aziridinium ring (partial)
        const ring = document.createElementNS(svgNS, 'path');
        ring.setAttribute('d', 'M -10 10 Q 0 0 0 0');
        ring.setAttribute('fill', 'none');
        ring.setAttribute('stroke', '#8E44AD');
        ring.setAttribute('stroke-width', '3');
        ring.setAttribute('stroke-linejoin', 'round');
        group.appendChild(ring);
        
        // Carbon atom
        const carbon = createAtom(group, `${id}-c`, -10, 10, '#5D6D7E', 'C', 8);
        
        // Remaining chloroethyl arm
        const remainingArm = createChloroethylArm(group, `${id}-remaining`, 0, 0, '#1a2980');
        
        return {
            group,
            elements: [...nitrogen, ...carbon, ring, ...remainingArm.elements]
        };
    }

    function generateDistortedDNAPath(dna) {
        // This would generate a path with a kink at the crosslink site
        // Implementation depends on your specific DNA representation
        return dna.strand1.getAttribute('d').replace(/L/g, 'L') + 'Z';
    }

    function createReplicationFork(parent, x, y) {
        const group = document.createElementNS(svgNS, 'g');
        group.setAttribute('transform', `translate(${x},${y})`);
        parent.appendChild(group);
        
        const elements = [];
        
        // Simplified replication fork representation
        const fork = document.createElementNS(svgNS, 'path');
        fork.setAttribute('d', 'M -50 0 L 0 -20 L 50 0 L 0 20 Z');
        fork.setAttribute('fill', '#9B59B6');
        fork.setAttribute('opacity', '0.7');
        group.appendChild(fork);
        elements.push(fork);
        
        // Polymerase
        const polymerase = document.createElementNS(svgNS, 'circle');
        polymerase.setAttribute('cx', 0);
        polymerase.setAttribute('cy', 0);
        polymerase.setAttribute('r', 15);
        polymerase.setAttribute('fill', '#3498DB');
        polymerase.setAttribute('opacity', '0.7');
        group.appendChild(polymerase);
        elements.push(polymerase);
        
        return {
            group,
            elements
        };
    }

    function createDamageResponseProteins(parent, x, y) {
        const group = document.createElementNS(svgNS, 'g');
        group.setAttribute('transform', `translate(${x},${y})`);
        parent.appendChild(group);
        
        const elements = [];
        
        // Simplified protein representations
        const proteins = ['ATM', 'ATR', 'p53', 'Chk2'].map((name, i) => {
            const protein = document.createElementNS(svgNS, 'circle');
            protein.setAttribute('cx', i * 30 - 45);
            protein.setAttribute('cy', 0);
            protein.setAttribute('r', 12);
            protein.setAttribute('fill', ['#E74C3C', '#3498DB', '#2ECC71', '#F39C12'][i]);
            group.appendChild(protein);
            
            const label = document.createElementNS(svgNS, 'text');
            label.setAttribute('x', i * 30 - 45);
            label.setAttribute('y', 0);
            label.setAttribute('text-anchor', 'middle');
            label.setAttribute('dy', '.3em');
            label.setAttribute('font-size', '8');
            label.setAttribute('fill', 'white');
            label.textContent = name;
            group.appendChild(label);
            
            return [protein, label];
        });
        
        elements.push(...proteins.flat());
        
        return {
            group,
            elements
        };
    }

    function createApoptoticCascade(parent, x, y) {
        const group = document.createElementNS(svgNS, 'g');
        group.setAttribute('transform', `translate(${x},${y})`);
        parent.appendChild(group);
        
        const elements = [];
        
        // Simplified apoptotic pathway
        const steps = [
            { name: 'Cytochrome c', color: '#E74C3C' },
            { name: 'Apaf-1', color: '#3498DB' },
            { name: 'Caspase-9', color: '#2ECC71' },
            { name: 'Caspase-3', color: '#F39C12' }
        ];
        
        steps.forEach((step, i) => {
            const element = document.createElementNS(svgNS, 'circle');
            element.setAttribute('cx', i * 40 - 60);
            element.setAttribute('cy', 0);
            element.setAttribute('r', 12);
            element.setAttribute('fill', step.color);
            group.appendChild(element);
            
            const label = document.createElementNS(svgNS, 'text');
            label.setAttribute('x', i * 40 - 60);
            label.setAttribute('y', 0);
            label.setAttribute('text-anchor', 'middle');
            label.setAttribute('dy', '.3em');
            label.setAttribute('font-size', '8');
            label.setAttribute('fill', 'white');
            label.textContent = step.name;
            group.appendChild(label);
            
            elements.push(element, label);
            
            if (i > 0) {
                const arrow = createBond(group, 
                    (i-1)*40 - 60 + 12, 0, 
                    i*40 - 60 - 12, 0, 
                    '#7F8C8D', 2);
                elements.push(arrow);
            }
        });
        
        return {
            group,
            elements
        };
    }

    // Tooltip functions
    function showAnimationTooltip(event, content) {
        let tooltip = document.querySelector('.animation-tooltip');
        if (!tooltip) {
            tooltip = document.createElement('div');
            tooltip.className = 'animation-tooltip';
            document.body.appendChild(tooltip);
        }
        
        tooltip.innerHTML = content;
        tooltip.style.left = `${event.clientX}px`;
        tooltip.style.top = `${event.clientY}px`;
        
        gsap.to(tooltip, {
            opacity: 1,
            duration: 0.2
        });
    }

    function hideAnimationTooltip() {
        const tooltip = document.querySelector('.animation-tooltip');
        if (tooltip) {
            gsap.to(tooltip, {
                opacity: 0,
                duration: 0.2
            });
        }
    }
</script>
</body>
</html>
